<div class="container mt-5">
  <div class="card" style="text-align: center;">
    <img src="<%= @user.image %>" width="100" height="100" style="display: block; margin: auto;" class="mt-3">
    <div class="card-body">
      <h5 class="card-title"><%= @user.name %></h5>
      <h5 id="user_level">Level: <%= @user.level %></h5>

      <div class="progress" role="progressbar" aria-label="Category 1" aria-valuenow="<%= @completion_percentage %>" aria-valuemin="0" aria-valuemax="100">
        <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: <%= @completion_percentage %>%"></div>
      </div>
      <div class="progress" role="progressbar" aria-label="Category 2" aria-valuenow="<%= @completion_percentage %>" aria-valuemin="0" aria-valuemax="100">
        <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" style="width: <%= @completion_percentage %>%"></div>
      </div>
      <div class="progress" role="progressbar" aria-label="Category 3" aria-valuenow="<%= @completion_percentage %>" aria-valuemin="0" aria-valuemax="100">
        <div class="progress-bar progress-bar-striped progress-bar-animated bg-info" style="width: <%= @completion_percentage %>%"></div>
      </div>
      <div class="progress" role="progressbar" aria-label="Category 4" aria-valuenow="<%= @completion_percentage %>" aria-valuemin="0" aria-valuemax="100">
        <div class="progress-bar progress-bar-striped progress-bar-animated bg-warning" style="width: <%= @completion_percentage %>%"></div>
      </div>
      <div class="progress" role="progressbar" aria-label="Category 5" aria-valuenow="<%= @completion_percentage %>" aria-valuemin="0" aria-valuemax="100">
        <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger" style="width: <%= @completion_percentage %>%"></div>
      </div>

      <div class="d-flex justify-content-center gap-3" style="align-items: center;">
        <a href="https://twitter.com/<%= @user.nickname %>" target="_blank"><i class="bi bi-twitter" style="color: #00aced; font-size: 1.5rem;"></i></a>
      </div>
      <script>
        function tweet() {
          var text = "テッテレー♪レベル<%= @user.level %>にあがった！";
          var url = "https://credo-quest-89cb26ab4d84.herokuapp.com/users \n";
          var hashtags = "CREDO_QUEST,RUNTEQ";
          var via = "CREDO_QUEST";
          var tweetUrl = "https://twitter.com/share?url=" + encodeURIComponent(url)
            + "&text=" + encodeURIComponent(text)
            + "&via=" + encodeURIComponent(via)
            + "&hashtags=" + encodeURIComponent(hashtags);
          window.open(tweetUrl);
        }
      </script>
      <button onclick="tweet()" class="btn btn-info text-light"><i class="bi bi-twitter">Tweet</i></button>
    </div>
  </div>

  <br>
  <div id="flash">
    <%= render "shared/flash" %>
  </div>

  <div>
    <ul class="nav nav-pills nav-fill bg-light" id="categoryTabs" role="tablist">
      <% DEFAULT_TODOS.keys.each_with_index do |category, index| %>
        <li class="nav-item" role="presentation">
          <a class="nav-link <%= 'active' if index == 0 %>" id="<%= "#{category}-tab" %>" data-bs-toggle="tab" href="#<%= category %>" role="tab" aria-controls="<%= category %>" aria-selected="<%= 'true' if index == 0 %>">
            <%= category %>
          </a>
        </li>
      <% end %>
    </ul>
    <div class="tab-content" id="categoryTabDescripitions">
      <% @default_todos_grouped.each_with_index do |(category, todos), index| %>
        <div class="tab-pane fade <%= 'show active' if index == 0 %>" id="<%= category %>" role="tabpanel" aria-labelledby="<%= "#{category}-tab" %>">
          <ul class="list-group">
            <% todos.each_with_index do |todo, index| %>
              <li class="list-group-item">
                <%= form_with(model: todo, method: :patch, local: true) do |form| %>
                  Level: <%= index + 1 %>
                  <%= form.check_box :checked, class: "form-check-input me-1", onchange: 'this.form.requestSubmit()', id: "todo_checked_#{todo.id}" %>
                  <%= form.label :checked, todo.description, class: "form-check-label", for: "todo_checked_#{todo.id}" %>
                <% end %>
              </li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </div>
  </div>

</div>
